Documentação API Pagador Rest: http://apidocs.braspag.com.br

******* COMO USAR ********

CONFIGURAR

  1 - Instale a gem kgem_braspag_rest

  2 - Informar o MerchantID e MerchantKey
    Em projetos Rails basta criar um arquivo .rb no diretório initializers e seguir o exemplo abaixo:

    require 'kgem_braspag_rest'

    KBraspag.configuration do |config|
      config.merchant_id = "MeuMerchantID"
      config.merchant_key = "MeuMerchantKey"
    end

REALIZAR PAGAMENTOS
 - Exemplo Boleto
    boleto = KBraspag::CompletePaymentSlip.new # Ou use o alias KBraspag::CPS.new
    boleto.customer.name = "José da Silva"
    boleto.customer.identity_type = 'CPF' # CPF|CNPJ
    boleto.customer.identity = "1234567890"
    boleto.customer.email = "email@email.com"
    boleto.customer.birthdate = "1999-10-10" # YYYY-MM-DD

    boleto.customer.address.street = "Minha Rua"
    boleto.customer.address.number = "1234"
    boleto.customer.address.complemento = "Meu Complemento"
    boleto.customer.address.zip_code = "86010-540"
    boleto.customer.address.city = "Minha Cidade"
    boleto.customer.address.state = "PR" #Deve ser a sigla
    boleto.customer.address.country = "BRA" #Opcional o default já é Brasil

    boleto.customer.delivery_address.street = "Minha Rua"
    boleto.customer.delivery_address.number = "1234"
    boleto.customer.delivery_address.complement = "Meu Complemento"
    boleto.customer.delivery_address.zip_code = "86010-540"
    boleto.customer.delivery_address.city = "Minha Cidade"
    boleto.customer.delivery_address.state = "PR" #Deve ser a sigla
    boleto.customer.delivery_address.country = "BRA" #Opcional o default já é Brasil

    boleto.merchant_order_id = '2014111703'
    boleto.payment.amount = 15700 #Ou 15.700, "15,700"
    boleto.payment.provider = :meu_banco
    boleto.payment.address = "Rua Teste"
    boleto.payment.payment_slip_number = "123"
    boleto.payment.assignor = "Empresa Teste"
    boleto.payment.demonstrative = "Desmonstrative Teste"
    boleto.payment.expiration_date = "2020-05-1"
    boleto.payment.instructions = "Aceitar somente até a data de vencimento, após essa data juros de 1% dia."

    # Tentar realizar o pagamento
    resposta = boleto.pay

    #Verificar se a transação foi realizada com sucesso (true|false)
    resposta.success?

    #Verificar se a transação teve o pagamento confirmado (true| false)
    resposta.paid?

    #Verificar todas as mensagens retornadas pelo gateway (Array)
    resposta.messages

    #Verificar a messagem retornada de maior relevancia (String)
    resposta.messages.first

 - Exemplo Cartão de Crédito
    cartao = KBraspag::SimplifiedCreditCard.new # Ou KBraspag::SCC.new
    cartao.merchant_order_id = '2014111703'
    cartao.payment.capture = true # default já é true, portanto pode ser omitido a atribuição
    cartao.payment.amount = 15700
    cartao.payment.provider = :minha_operadora
    cartao.payment.installments = 1
    cartao.customer.name = "José da Silva"
    cartao.credit_card.card_number = "0000000000000006"
    cartao.credit_card.holder = "J Silva"
    cartao.credit_card.expiration_date = "12/2021"
    cartao.credit_card.security_code = "123"
    cartao.credit_card.brand = :minha_bandeira

    # Tentar realizar o pagamento
    resposta = cartao.pay

    #Verificar se a transação foi realizada com sucesso (true|false)
    resposta.success?

    #Verificar se a transação teve o pagamento confirmado (true| false)
    resposta.paid?

    #Verificar todas as mensagens retornadas pelo gateway (Array)
    resposta.messages

    #Verificar a messagem retornada de maior relevancia (String)
    resposta.messages.first

CANCELAR PAGAMENTO
  - Exemplo cancelar transação
    cancelar = KBraspag::Cancel.new # Ou KBraspag::C.new

    cancelar.payment_id = "uuid da transação"

    # Caso não seja informado o valor é estornado todo o valor da transação
    cancelar.amount = 10 # Ou 10.00, "10,00"

    # Tentar cancelar/estornar
    resposta = cancelar.cancel

    #Verificar se a transação foi realizada com sucesso (true|false)
    resposta.success?

    #Verificar todas as mensagens retornadas pelo gateway (Array)
    resposta.messages

    #Verificar a messagem retornada de maior relevancia (String)
    resposta.messages.first

******* ALTERAR AS CONFIGURAÇÕES DEFAULT *********

Exemplos:

1 - Desejo alterar somente o timeout de 5 segundos para 15 segundos.

    KBraspag.configuration { |config| config.timeout = 15 }

2 - Desejo incluir mais um gerador de boleto

    KBraspag.configuration { |config| config.payment_slip_providers[:santander] = "Santander" }

3 - Desejo substituir todas operadores de cartões

    kBraspag.configuration do |config|
      config.credit_card_providers = {
                                       :operadora1 => 'Operadora 1',
                                       :operadora2 => 'Operadora 2'
                                     }
    end


Abaixo está listado todas as configurações disponíveis e os valores default

KBraspag.configuration do |config|

  ## FILE PATH TO CA CERTIFICATE (*.pem)
  config.ca_file_path, "./braspag.pem"

  ## PAYMENT METHODS AVAILABLE
  config.payment_types, {
                          :credit_card => "CreditCard",
                          :debit_card => "DebitCard",
                          :eletronic_transfer => "EletronicTransfer",
                          :payment_slip => "Boleto"
                         }

  ## CREDIT CARD BRANDS AVAILABLE
  config.brands, {
                    :visa => 'Visa', :mastercard => 'Master',
                    :amex => 'Amex', :elo => 'Elo', :aura => 'Aura',
                    :jcb => 'JCB', :diners => 'Diners',
                    :discover => 'Discover', :hipercard => 'Hipercard',
                    :hiper => 'Hiper'
                  }

  ## AVAILABLE PROVIDERS LIST
  config.credit_card_providers, {
                                   :simulado => "Simulado",
                                   :cielo => "Cielo",
                                   :rede => "Redecard"
                                 }
  config.debit_providers, {:cielo => "Cielo"}
  config.payment_slip_providers, {
                                    :bradesco => "Bradesco",
                                    :banco_do_brasil => "BancoDoBrasil",
                                    :citibank => "CitiBank",
                                    :itau => "Itau",
                                    :brb => "Brb",
                                    :caixa => "Caixa",
                                    :santander => "Santander",
                                    :simulado => "Simulado"
                                  }
  config.eletronic_transfer_providers, {
                                          :bradesco => "Bradesco",
                                          :simulado => "Simulado"
                                        }

  ##REQUEST SETTINGS
  config.timeout, 15
  config.merchant_id, "e895fcba-14df-49f6-a019-e576c136f520"
  config.merchant_key, "FLKAVCQRLZKEZFFSDOYDBXPMWSUYWFSCMGDNKYYJ"
  config.connection_attempts, 3

  ##URLs
  config.payment_url, "https://apisandbox.braspag.com.br"
  config.query_url, "https://apiquerysandbox.braspag.com.br"

  ##RESOURCES
  config.complete_payment_slip_resource, "/v2/sales/"
  config.simplified_credit_card_resource, "/v2/sales/"
  config.cancel_resource, "/v2/sales/"
end
